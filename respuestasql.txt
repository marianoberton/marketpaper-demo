| schemaname | tablename              | policyname                                             | permissive | roles           | cmd    | qual                                                                                                                                                                                                                                                                                |
| ---------- | ---------------------- | ------------------------------------------------------ | ---------- | --------------- | ------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| public     | chatbot_analytics      | Users can create chatbot analytics for their company   | PERMISSIVE | {public}        | INSERT | null                                                                                                                                                                                                                                                                                |
| public     | chatbot_analytics      | Users can delete their company chatbot analytics       | PERMISSIVE | {public}        | DELETE | (is_super_admin() OR ((auth.uid() IS NOT NULL) AND (company_id = get_my_company_id())))                                                                                                                                                                                             |
| public     | chatbot_analytics      | Users can update their company chatbot analytics       | PERMISSIVE | {public}        | UPDATE | (is_super_admin() OR ((auth.uid() IS NOT NULL) AND (company_id = get_my_company_id())))                                                                                                                                                                                             |
| public     | chatbot_analytics      | Users can view their company chatbot analytics         | PERMISSIVE | {public}        | SELECT | (is_super_admin() OR ((auth.uid() IS NOT NULL) AND (company_id = get_my_company_id())))                                                                                                                                                                                             |
| public     | chatbot_contacts       | Users can create chatbot contacts for their company    | PERMISSIVE | {public}        | INSERT | null                                                                                                                                                                                                                                                                                |
| public     | chatbot_contacts       | Users can delete their company chatbot contacts        | PERMISSIVE | {public}        | DELETE | (is_super_admin() OR ((auth.uid() IS NOT NULL) AND (company_id = get_my_company_id())))                                                                                                                                                                                             |
| public     | chatbot_contacts       | Users can update their company chatbot contacts        | PERMISSIVE | {public}        | UPDATE | (is_super_admin() OR ((auth.uid() IS NOT NULL) AND (company_id = get_my_company_id())))                                                                                                                                                                                             |
| public     | chatbot_contacts       | Users can view their company chatbot contacts          | PERMISSIVE | {public}        | SELECT | (is_super_admin() OR ((auth.uid() IS NOT NULL) AND (company_id = get_my_company_id())))                                                                                                                                                                                             |
| public     | chatbot_messages       | Users can create chatbot messages for their company    | PERMISSIVE | {public}        | INSERT | null                                                                                                                                                                                                                                                                                |
| public     | chatbot_messages       | Users can delete their company chatbot messages        | PERMISSIVE | {public}        | DELETE | (is_super_admin() OR ((auth.uid() IS NOT NULL) AND (company_id = get_my_company_id())))                                                                                                                                                                                             |
| public     | chatbot_messages       | Users can update their company chatbot messages        | PERMISSIVE | {public}        | UPDATE | (is_super_admin() OR ((auth.uid() IS NOT NULL) AND (company_id = get_my_company_id())))                                                                                                                                                                                             |
| public     | chatbot_messages       | Users can view their company chatbot messages          | PERMISSIVE | {public}        | SELECT | (is_super_admin() OR ((auth.uid() IS NOT NULL) AND (company_id = get_my_company_id())))                                                                                                                                                                                             |
| public     | chatbot_sessions       | Users can manage their company chatbot sessions        | PERMISSIVE | {public}        | ALL    | (is_super_admin() OR ((auth.uid() IS NOT NULL) AND (company_id = get_my_company_id())))                                                                                                                                                                                             |
| public     | chatbot_sessions       | Users can view their company chatbot sessions          | PERMISSIVE | {public}        | SELECT | (is_super_admin() OR ((auth.uid() IS NOT NULL) AND (company_id = get_my_company_id())))                                                                                                                                                                                             |
| public     | client_templates       | Authenticated users can read templates                 | PERMISSIVE | {public}        | SELECT | (auth.role() = 'authenticated'::text)                                                                                                                                                                                                                                               |
| public     | client_templates       | Authenticated users can view client templates          | PERMISSIVE | {public}        | SELECT | (auth.role() = 'authenticated'::text)                                                                                                                                                                                                                                               |
| public     | client_templates       | Super admins can manage templates                      | PERMISSIVE | {public}        | ALL    | is_super_admin(auth.uid())                                                                                                                                                                                                                                                          |
| public     | clients                | Authenticated users can create clients                 | PERMISSIVE | {public}        | INSERT | null                                                                                                                                                                                                                                                                                |
| public     | clients                | Authenticated users can update clients                 | PERMISSIVE | {public}        | UPDATE | (is_super_admin() OR ((auth.uid() IS NOT NULL) AND (company_id = get_my_company_id())))                                                                                                                                                                                             |
| public     | clients                | Authenticated users can view clients                   | PERMISSIVE | {public}        | SELECT | (is_super_admin() OR ((auth.uid() IS NOT NULL) AND (company_id = get_my_company_id())))                                                                                                                                                                                             |
| public     | companies              | Allow authenticated users to read companies            | PERMISSIVE | {public}        | SELECT | (auth.role() = 'authenticated'::text)                                                                                                                                                                                                                                               |
| public     | companies              | Authenticated users can read companies                 | PERMISSIVE | {public}        | SELECT | (auth.role() = 'authenticated'::text)                                                                                                                                                                                                                                               |
| public     | companies              | Company owners can update their company                | PERMISSIVE | {public}        | UPDATE | ((id = get_user_company_id()) AND (EXISTS ( SELECT 1
   FROM user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND ((user_profiles.role)::text = 'company_owner'::text)))))                                                                                                    |
| public     | companies              | Company owners can view their company                  | PERMISSIVE | {public}        | SELECT | ((id = get_user_company_id()) AND (EXISTS ( SELECT 1
   FROM user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND ((user_profiles.role)::text = ANY ((ARRAY['company_owner'::character varying, 'company_admin'::character varying])::text[]))))))                            |
| public     | companies              | Super admins can manage companies                      | PERMISSIVE | {public}        | ALL    | is_super_admin()                                                                                                                                                                                                                                                                    |
| public     | companies              | Users can delete their own company                     | PERMISSIVE | {public}        | DELETE | (id = ( SELECT user_profiles.company_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid())))                                                                                                                                                                             |
| public     | companies              | Users can update their own company                     | PERMISSIVE | {public}        | UPDATE | (id = ( SELECT user_profiles.company_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid())))                                                                                                                                                                             |
| public     | company_api_keys       | Company admins can manage company API keys             | PERMISSIVE | {public}        | ALL    | ((company_id IN ( SELECT user_profiles.company_id
   FROM user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND ((user_profiles.role)::text = ANY ((ARRAY['owner'::character varying, 'admin'::character varying])::text[]))))) OR is_super_admin())                           |
| public     | contact_leads          | Allow public insert for contact forms                  | PERMISSIVE | {public}        | INSERT | null                                                                                                                                                                                                                                                                                |
| public     | contact_leads          | Users can delete contact_leads from their company      | PERMISSIVE | {public}        | DELETE | ((company_id IN ( SELECT user_profiles.company_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid()))) OR (EXISTS ( SELECT 1
   FROM super_admins
  WHERE ((super_admins.user_id = auth.uid()) AND ((super_admins.status)::text = 'active'::text)))))                    |
| public     | contact_leads          | Users can update contact_leads from their company      | PERMISSIVE | {public}        | UPDATE | ((company_id IN ( SELECT user_profiles.company_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid()))) OR (EXISTS ( SELECT 1
   FROM super_admins
  WHERE ((super_admins.user_id = auth.uid()) AND ((super_admins.status)::text = 'active'::text)))))                    |
| public     | contact_leads          | Users can view contact_leads from their company        | PERMISSIVE | {public}        | SELECT | ((company_id IN ( SELECT user_profiles.company_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid()))) OR (EXISTS ( SELECT 1
   FROM super_admins
  WHERE ((super_admins.user_id = auth.uid()) AND ((super_admins.status)::text = 'active'::text)))))                    |
| public     | message_buffer         | Users can manage their company message buffer          | PERMISSIVE | {public}        | ALL    | (is_super_admin() OR ((auth.uid() IS NOT NULL) AND (company_id = get_my_company_id())))                                                                                                                                                                                             |
| public     | message_buffer         | Users can view their company message buffer            | PERMISSIVE | {public}        | SELECT | (is_super_admin() OR ((auth.uid() IS NOT NULL) AND (company_id = get_my_company_id())))                                                                                                                                                                                             |
| public     | modules                | Authenticated users can read modules                   | PERMISSIVE | {public}        | SELECT | (auth.role() = 'authenticated'::text)                                                                                                                                                                                                                                               |
| public     | modules                | Super admins can manage modules                        | PERMISSIVE | {public}        | ALL    | is_super_admin(auth.uid())                                                                                                                                                                                                                                                          |
| public     | project_documents      | Allow all operations for authenticated users           | PERMISSIVE | {public}        | ALL    | true                                                                                                                                                                                                                                                                                |
| public     | project_expedientes    | Authenticated users can create project expedientes     | PERMISSIVE | {public}        | INSERT | null                                                                                                                                                                                                                                                                                |
| public     | project_expedientes    | Authenticated users can delete project expedientes     | PERMISSIVE | {public}        | DELETE | (is_super_admin() OR ((auth.uid() IS NOT NULL) AND (project_id IN ( SELECT projects.id
   FROM projects
  WHERE (projects.company_id = get_my_company_id())))))                                                                                                                     |
| public     | project_expedientes    | Authenticated users can update project expedientes     | PERMISSIVE | {public}        | UPDATE | (is_super_admin() OR ((auth.uid() IS NOT NULL) AND (project_id IN ( SELECT projects.id
   FROM projects
  WHERE (projects.company_id = get_my_company_id())))))                                                                                                                     |
| public     | project_expedientes    | Authenticated users can view project expedientes       | PERMISSIVE | {public}        | SELECT | (is_super_admin() OR ((auth.uid() IS NOT NULL) AND (project_id IN ( SELECT projects.id
   FROM projects
  WHERE (projects.company_id = get_my_company_id())))))                                                                                                                     |
| public     | project_sections       | Authenticated users can create project sections        | PERMISSIVE | {public}        | INSERT | null                                                                                                                                                                                                                                                                                |
| public     | project_sections       | Authenticated users can view project sections          | PERMISSIVE | {public}        | SELECT | (is_super_admin() OR ((auth.uid() IS NOT NULL) AND (project_id IN ( SELECT projects.id
   FROM projects
  WHERE (projects.company_id = get_my_company_id())))))                                                                                                                     |
| public     | project_stages         | Authenticated users can manage project stages          | PERMISSIVE | {public}        | ALL    | (is_super_admin() OR ((auth.uid() IS NOT NULL) AND (company_id = get_my_company_id())))                                                                                                                                                                                             |
| public     | project_stages         | Authenticated users can view project stages            | PERMISSIVE | {public}        | SELECT | (is_super_admin() OR ((auth.uid() IS NOT NULL) AND (company_id = get_my_company_id())))                                                                                                                                                                                             |
| public     | project_status_history | Authenticated users can create status history          | PERMISSIVE | {public}        | INSERT | null                                                                                                                                                                                                                                                                                |
| public     | project_status_history | Authenticated users can view status history            | PERMISSIVE | {public}        | SELECT | (is_super_admin() OR ((auth.uid() IS NOT NULL) AND (project_id IN ( SELECT projects.id
   FROM projects
  WHERE (projects.company_id = get_my_company_id())))))                                                                                                                     |
| public     | projects               | Authenticated users can create projects                | PERMISSIVE | {public}        | INSERT | null                                                                                                                                                                                                                                                                                |
| public     | projects               | Authenticated users can update projects                | PERMISSIVE | {public}        | UPDATE | (is_super_admin() OR ((auth.uid() IS NOT NULL) AND (company_id = get_my_company_id())))                                                                                                                                                                                             |
| public     | projects               | Authenticated users can view projects                  | PERMISSIVE | {public}        | SELECT | (is_super_admin() OR ((auth.uid() IS NOT NULL) AND (company_id = get_my_company_id())))                                                                                                                                                                                             |
| public     | properties             | Users can manage their company properties              | PERMISSIVE | {public}        | ALL    | (is_super_admin() OR ((auth.uid() IS NOT NULL) AND (company_id = get_my_company_id())))                                                                                                                                                                                             |
| public     | properties             | Users can view their company properties                | PERMISSIVE | {public}        | SELECT | (is_super_admin() OR ((auth.uid() IS NOT NULL) AND (company_id = get_my_company_id())))                                                                                                                                                                                             |
| public     | pyme_leads             | Allow public insert for pyme leads                     | PERMISSIVE | {public}        | INSERT | null                                                                                                                                                                                                                                                                                |
| public     | pyme_leads             | Super admins can access all pyme leads                 | PERMISSIVE | {public}        | ALL    | (EXISTS ( SELECT 1
   FROM user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND ((user_profiles.role)::text = 'super_admin'::text))))                                                                                                                                         |
| public     | pyme_leads             | Users can delete leads from their company              | PERMISSIVE | {public}        | DELETE | (company_id IN ( SELECT user_profiles.company_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid())))                                                                                                                                                                    |
| public     | pyme_leads             | Users can update leads from their company              | PERMISSIVE | {public}        | UPDATE | (company_id IN ( SELECT user_profiles.company_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid())))                                                                                                                                                                    |
| public     | pyme_leads             | Users can view leads from their company                | PERMISSIVE | {public}        | SELECT | (company_id IN ( SELECT user_profiles.company_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid())))                                                                                                                                                                    |
| public     | registration_requests  | Anyone can insert registration requests                | PERMISSIVE | {public}        | INSERT | null                                                                                                                                                                                                                                                                                |
| public     | registration_requests  | Super admins can update registration requests          | PERMISSIVE | {public}        | UPDATE | (EXISTS ( SELECT 1
   FROM super_admins sa
  WHERE ((sa.user_id = auth.uid()) AND ((sa.status)::text = 'active'::text))))                                                                                                                                                           |
| public     | registration_requests  | Super admins can view all registration requests        | PERMISSIVE | {public}        | SELECT | (EXISTS ( SELECT 1
   FROM super_admins sa
  WHERE ((sa.user_id = auth.uid()) AND ((sa.status)::text = 'active'::text))))                                                                                                                                                           |
| public     | super_admins           | Super admins can manage everything                     | PERMISSIVE | {public}        | ALL    | is_super_admin()                                                                                                                                                                                                                                                                    |
| public     | tax_payments           | Authenticated users can manage tax payments            | PERMISSIVE | {public}        | ALL    | (is_super_admin() OR ((auth.uid() IS NOT NULL) AND (project_id IN ( SELECT projects.id
   FROM projects
  WHERE (projects.company_id = get_my_company_id())))))                                                                                                                     |
| public     | tax_payments           | Authenticated users can view tax payments              | PERMISSIVE | {public}        | SELECT | (is_super_admin() OR ((auth.uid() IS NOT NULL) AND (project_id IN ( SELECT projects.id
   FROM projects
  WHERE (projects.company_id = get_my_company_id())))))                                                                                                                     |
| public     | template_modules       | Authenticated users can read template_modules          | PERMISSIVE | {public}        | SELECT | (auth.role() = 'authenticated'::text)                                                                                                                                                                                                                                               |
| public     | template_modules       | Super admins can manage template_modules               | PERMISSIVE | {public}        | ALL    | is_super_admin(auth.uid())                                                                                                                                                                                                                                                          |
| public     | user_api_keys          | Users can manage own API keys                          | PERMISSIVE | {public}        | ALL    | ((user_id = auth.uid()) OR (company_id IN ( SELECT user_profiles.company_id
   FROM user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND ((user_profiles.role)::text = ANY ((ARRAY['owner'::character varying, 'admin'::character varying])::text[]))))) OR is_super_admin()) |
| public     | user_profiles          | Users can view company members                         | PERMISSIVE | {public}        | SELECT | ((company_id = get_my_company_id()) OR is_super_admin())                                                                                                                                                                                                                            |
| storage    | objects                | Authenticated users can upload construction documents  | PERMISSIVE | {authenticated} | INSERT | null                                                                                                                                                                                                                                                                                |
| storage    | objects                | Authenticated users can upload project images          | PERMISSIVE | {authenticated} | INSERT | null                                                                                                                                                                                                                                                                                |
| storage    | objects                | Authenticated users can view construction documents    | PERMISSIVE | {authenticated} | SELECT | (bucket_id = 'construction-documents'::text)                                                                                                                                                                                                                                        |
| storage    | objects                | Authenticated users can view project images            | PERMISSIVE | {authenticated} | SELECT | (bucket_id = 'project-images'::text)                                                                                                                                                                                                                                                |
| storage    | objects                | Permitir actualización de documentos de construcción   | PERMISSIVE | {public}        | UPDATE | (bucket_id = 'construction-documents'::text)                                                                                                                                                                                                                                        |
| storage    | objects                | Permitir actualización de imágenes de proyectos        | PERMISSIVE | {public}        | UPDATE | (bucket_id = 'project-images'::text)                                                                                                                                                                                                                                                |
| storage    | objects                | Permitir eliminación de documentos de construcción     | PERMISSIVE | {public}        | DELETE | (bucket_id = 'construction-documents'::text)                                                                                                                                                                                                                                        |
| storage    | objects                | Permitir eliminación de imágenes de proyectos          | PERMISSIVE | {public}        | DELETE | (bucket_id = 'project-images'::text)                                                                                                                                                                                                                                                |
| storage    | objects                | Permitir inserción de documentos de construcción       | PERMISSIVE | {public}        | INSERT | null                                                                                                                                                                                                                                                                                |
| storage    | objects                | Permitir inserción de imágenes de proyectos            | PERMISSIVE | {public}        | INSERT | null                                                                                                                                                                                                                                                                                |
| storage    | objects                | Permitir lectura pública de documentos de construcción | PERMISSIVE | {public}        | SELECT | (bucket_id = 'construction-documents'::text)                                                                                                                                                                                                                                        |
| storage    | objects                | Permitir lectura pública de imágenes de proyectos      | PERMISSIVE | {public}        | SELECT | (bucket_id = 'project-images'::text)                                                                                                                                                                                                                                                |
| storage    | objects                | Users can delete their own construction documents      | PERMISSIVE | {authenticated} | DELETE | ((bucket_id = 'construction-documents'::text) AND ((auth.uid())::text = (storage.foldername(name))[1]))                                                                                                                                                                             |
| storage    | objects                | Users can delete their own project images              | PERMISSIVE | {authenticated} | DELETE | ((bucket_id = 'project-images'::text) AND ((auth.uid())::text = (storage.foldername(name))[1]))                                                                                                                                                                                     |
| storage    | objects                | Users can update their own construction documents      | PERMISSIVE | {authenticated} | UPDATE | ((bucket_id = 'construction-documents'::text) AND ((auth.uid())::text = (storage.foldername(name))[1]))                                                                                                                                                                             |
| storage    | objects                | Users can update their own project images              | PERMISSIVE | {authenticated} | UPDATE | ((bucket_id = 'project-images'::text) AND ((auth.uid())::text = (storage.foldername(name))[1]))                                                                                                                                                                                     |